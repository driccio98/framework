var r=class{static join(...e){return this.normalize(e)}static normalize(e){let t=(typeof e=="string"?e.split(this.separator):e).filter(s=>s!==""),i=[];for(let s=0;s<t.length;s++)t[s]===".."?i.length>0&&i[i.length-1]!==".."?i.pop():i.push(".."):t[s]!=="."&&i.push(t[s]);return i.join(this.separator)}static relative(e,t){let i=this.normalize(e).split(this.separator),s=this.normalize(t).split(this.separator),n=[],o=0;for(;s[o]!==void 0&&i[o]===s[o];)++o;for(let a=s.length-o;a>0;a--)n.push("..");for(;i[o]!==void 0;)n.push(i[o++]);return n.join(this.separator)}static addSlashes(e){return e.replaceAll("\\","\\\\").replaceAll('"','\\"')}};r.separator="/",r.delimiter=":";var u=class{static resolvePath(e){return new Promise(async t=>{this.dirs[e]===null&&(this.dirs[e]=await Neutralino.os.getPath(e)),t(this.dirs[e])})}static get data(){return this.resolvePath("data")}static get documents(){return this.resolvePath("documents")}static get pictures(){return this.resolvePath("pictures")}static get music(){return this.resolvePath("music")}static get video(){return this.resolvePath("video")}static get downloads(){return this.resolvePath("downloads")}};u.dirs={temp:null,data:null,documents:null,pictures:null,music:null,video:null,downloads:null},u.cwd=NL_CWD,u.app=NL_PATH,u.temp="/tmp";var p=class{static read(e,t=!1){return new Promise(async i=>{i(t?await Neutralino.filesystem.readBinaryFile(e):await Neutralino.filesystem.readFile(e))})}static write(e,t){return new Promise(i=>{typeof t=="string"?Neutralino.filesystem.writeFile(e,t).then(i):Neutralino.filesystem.writeBinaryFile(e,t).then(i)})}static exists(e){return new Promise(t=>{Neutralino.filesystem.getStats(e).then(()=>t(!0)).catch(()=>t(!1))})}static stats(e){return new Promise(t=>{Neutralino.filesystem.getStats(e).then(i=>t({type:i.isFile?"file":"directory",size:i.size})).catch(()=>t(null))})}static remove(e){return new Promise(t=>{Neutralino.os.execCommand(`rm -rf "${r.addSlashes(e)}"`).then(()=>t())})}static files(e){return new Promise(t=>{Neutralino.filesystem.readDirectory(e).then(i=>{t(i.filter(s=>s!=="."&&s!==".."))})})}static mkdir(e){return new Promise(t=>{Neutralino.os.execCommand(`mkdir -p "${r.addSlashes(e)}"`).then(()=>t())})}static copy(e,t){return new Promise((i,s)=>{this.stats(e).then(n=>{n===null?s(new Error("File or directory doesn't exist")):Neutralino.os.execCommand(`cp -r "${r.addSlashes(e)}" "${r.addSlashes(t)}"`).then(()=>i())})})}static move(e,t){return new Promise((i,s)=>{this.stats(e).then(n=>{n===null?s(new Error("File or directory doesn't exist")):Neutralino.os.execCommand(`mv "${r.addSlashes(e)}" "${r.addSlashes(t)}"`).then(()=>i())})})}};var h=class{static get current(){return Neutralino.window}static open(e,t={}){return new Promise(async i=>{let s=await Neutralino.window.create(`/${e}.html`,{width:600,height:400,enableInspector:!1,exitProcessOnClose:!0,...t});i({status:s!==void 0,data:s})})}},f=h;var c=class{constructor(e,t=null){this.runningInterval=200;this.outputInterval=500;this.outputOffset=0;this._finished=!1;this.id=e,this.outputFile=t;let i=()=>{this.running().then(s=>{s?this.runningInterval&&setTimeout(i,this.runningInterval):(this._finished=!0,this.onFinish&&this.onFinish(this))})};if(this.runningInterval&&setTimeout(i,this.runningInterval),this.outputFile){let s=()=>{Neutralino.filesystem.readFile(this.outputFile).then(n=>{this.onOutput&&this.onOutput(n.substring(this.outputOffset),this),this.outputOffset=n.length,this._finished?Neutralino.filesystem.removeFile(this.outputFile):this.outputInterval&&setTimeout(s,this.outputInterval)}).catch(()=>{this.outputInterval&&!this._finished&&setTimeout(s,this.outputInterval)})};this.outputInterval&&setTimeout(s,this.outputInterval)}}get finished(){return this._finished}finish(e){this.onFinish=e,this._finished?e(this):this.runningInterval===null&&this.running().then(t=>{t||(this._finished=!0,e(this))})}output(e){this.onOutput=e}kill(e=!1){return Neutralino.filesystem.removeFile(this.outputFile),c.kill(this.id,e)}running(){return new Promise(e=>{Neutralino.os.execCommand(`ps -p ${this.id} -S`).then(t=>{e(t.stdOut.includes(this.id)&&!t.stdOut.includes("Z   "))})})}static run(e,t={}){return new Promise(async i=>{let s=`${await u.temp}/${1e4+Math.round(Math.random()*89999)}.tmp`;if(t.env)for(let a of Object.keys(t.env))e=`${a}="${r.addSlashes(t.env[a].toString())}" ${e}`;e=`${e} > "${r.addSlashes(s)}" 2>&1`,t.cwd&&(e=`cd "${r.addSlashes(t.cwd)}" && ${e}`);let n=await Neutralino.os.execCommand(e,{background:!0}),o=async()=>{let a=await Neutralino.os.execCommand(`pgrep -P ${n.pid}`);if(a.stdOut=="")setTimeout(o,t.childInterval??50);else{let b=parseInt(a.stdOut.substring(0,a.stdOut.length-1));i(new c(b,s))}};setTimeout(o,t.childInterval??50)})}static kill(e,t=!1){return new Promise(i=>{Neutralino.os.execCommand(`kill ${t?"-9":"-15"} ${e}`).then(()=>i())})}},g=c;Neutralino.events.on("trayMenuItemClicked",l=>{for(let e of d.trays)for(let t of e.items)if(t.id===l.detail.id){t.click&&t.click({id:l.detail.id,text:l.detail.text,disabled:l.detail.isDisabled,checked:l.detail.isChecked,click:t.click});return}});var m=class{constructor(e,t=[]){this._items=[];this.icon=e,this.items=t,m.trays.push(this)}get items(){return this._items.map(e=>({id:e.id,text:e.text,disabled:e.isDisabled,checked:e.isChecked,click:e.click}))}set items(e){this._items=e.map(t=>(t.id===void 0&&t.click!==void 0&&(t.id="click:"+Math.random().toString().substring(2)),{id:t.id,text:t.text,isDisabled:t.disabled,isChecked:t.checked,click:t.click}))}update(e=null){return e!==null&&(this.items=e),Neutralino.os.setTray({icon:this.icon,menuItems:this._items})}hide(){return Neutralino.os.setTray({icon:this.icon,menuItems:[]})}},d=m;d.trays=[];export{g as Process,d as Tray,f as Windows,u as dir,p as fs,r as path};
